---
title: "Report 2020"
author: "Michael Schmidt"
date: "11/24/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(arcgisbinding)
arc.check_product()

library(AIMtools)
library(schmidtytheme)
library(sf)
library(gt)
library(patchwork)
extrafont::loadfonts(device="win")

theme_set(theme_schmidt()+
            theme(
              text = element_text(family="Public Sans"),
              plot.background=element_rect( color="transparent"),
              panel.background=element_rect( fill = background_color,color="transparent")
            ))
```
Cashed all dbs on 11/24/2020.
```{r}
# agol_2020<-load_data()
# saveRDS(agol_2020, "test_cache/agol_2020.rds")
# agol_2019<-load_data(year=2019)
# saveRDS(agol_2019, "test_cache/agol_2019.rds")

agol_2020<-readRDS("test_cache/agol_2020.rds")
agol_2019<-readRDS("test_cache/agol_2019.rds")
dima<-readRDS("test_cache/DIMA_2018.rds")
```

# What do I want to accomplish with this?
This document is the beginning of an analysis. We have completed three out of a five years of our field office Assessment, Inventory and Monitoring sample design.  I hope to cover an overview of a summary of our sampling effort so far, and dig into a few interesting findings.  this will by no means be a final analysis.  Rather it will be a step in a more formalized analysis process for the Tres Rios Field Office. 

# What do I want to include in the summary

[] - Map of all of the plots

```{r}

pts_2020<-agol_2020$spatial%>%
  mutate(strata = str_extract(PlotKey, "_[A-Z][A-Z]-"),
         strata = str_extract(strata, "[A-Z][A-Z]"),
         year = 2020)%>%
  select(-PlotKey)

pts_2019<-agol_2019$spatial%>%
  mutate(strata = str_extract(PlotKey, "_[A-Z][A-Z]-"),
         strata = str_extract(strata, "[A-Z][A-Z]"),
         year = 2019)%>%
  select(-PlotKey)

pts_2018<-dima$spatial%>%
  mutate(year=2018,
         strata=str_extract(PlotID, "^[A-Z][A-Z]|GRSGInt"))%>%
  select(-SiteKey, -PlotKey, -PlotID)

all_years<-bind_rows(pts_2020, pts_2019, pts_2018)%>%
  strata_names()


trfo<-st_read("test_data/shapefiles/TRFO_BLM_LANDS.shp")

plots_by_year<-ggplot()+
  geom_sf(data=trfo, fill="#333333", color = "transparent")+
  geom_sf(data=all_years, aes(color = as.factor(year)), size=2, alpha=0.7)+
  theme(
    panel.grid = element_blank(),
    axis.text = element_blank(),
    legend.position = "bottom"
  )+
  labs(
    title="All Plots Tres Rios Field Office",
    color="Year"
  )+
  scale_color_brewer(palette="Dark2")


```

```{r}
strata_names<-function(x){
  x%>%
    dplyr::mutate(Strata = case_when(
      strata =="SS"~"Sagebrush Steppe",
      strata =="PJ"~"PiÃ±on and Juniper",
      strata =="SD"~"Salt Desert Scrub",
      strata =="GR"~"Grass",
      strata =="MS"~"Mixed-Mountain Shrub",
      strata =="AS"~"Aspen",
      strata =="PP"~"Ponderosa Pine",
      strata =="RI"~"Riparian",
      strata =="MC"~"Mixed Conifer"
    ))
}

all_years%>%
  as_tibble()%>%
  count(Strata, sort=T)%>%
  rename(Number = n)%>%
  gt()%>%
  tab_options(
    heading.title.font.weight = "bold",
    column_labels.font.weight = "bold",
  )%>%
  opt_table_font(font = google_font(name="Public Sans"), style = "normal")
  
strata_plot<-ggplot()+
  geom_sf(data=trfo, fill="#333333", color = "transparent")+
  geom_sf(data=all_years, aes(color = strata), size=2, alpha=0.7)+
  theme(
    panel.grid = element_blank(),
    axis.text = element_blank(),
    legend.position = "bottom"
  )+
  labs(
    title="Tres Rios Field Office Plots by Strata",
    color="Strata"
  )+
  scale_color_brewer(palette="Paired")

strata_plot+wrap_elements(strata_table)
```




[] - Table of the strata
[] - Table of what was completed
  * How many plots were finished in each strata, how many plots were rejected each year. 
[] - How many plants were identified each year. 

# More generalized analysis 
[] - Species richness by strata all years.

# Sage Grouse Information
[] - What plots are meet RCP guidelines
# Grazing Analysis
[] - How does grazing effect vegetation?

